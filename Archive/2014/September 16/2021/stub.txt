JLJac
101

*phew* <img src="https://web.archive.org/web/20141229083422im_/http://forums.tigsource.com/Smileys/derek/whome.gif" alt="Who, Me?" border="0"><br><br><b>Update 309</b><br>Finally I think that everything having to do with AI data being saved to level files is DONE! For each creature (or rather for each &quot;pathing template&quot;, some creatures share the same pathing data as their movement is similar) there are now several AI heatmaps that can easily be accessed. One of those is the dead end map, and then there is a dijkstra map for each room exit. <br><br><img src="https://web.archive.org/web/20141229083422im_/http://imgwiz.com/images/2014/09/17/DUa0O.gif" alt="" border="0"><br><br>Here&#039;s a visualization where I can look at the different AI maps for all the different creatures by moving the mouse around. The ones with little blinking dots are the dead end maps, and the blinking dots are the hub spots or fleeing targets. Saving those to the file was kind of a hassle as well, until I figured out I could just shift the float upwards with 2. (Shifting it with 1 would be risky as the range is 0..1 and then it wouldn&#039;t know the difference between an actual 1 and a 0 that had been shifted.)<br><br>This means that theoretically creatures could move around between exits with no path finding at all, just by following the dijsktra maps. In practice there are other things playing a role as well, such as the Obstacle Tracker, so most of the more intelligent creatures will still need to do actual path finding. For small, stupid, swarming creatures it could definitely be used though, enabling what looks like intelligent behavior with pretty much 0 strain on the processor.<br><br>What most creatures will be able to use the maps for, however, is having a better general understanding about where they (and stuff they interact with) are in space. Which exit am I closest to? Which exit am I closer to than any other creature? Considering a group of creatures, towards which exit do they gravitate?<br><br>I have this one idea though, let me share it with you and tell me what you think. The idea is that the dijkstra maps could be used as beacons for triangulation of distances between <i>arbitrary </i>points on the level. What I&#039;m talking about here is not distance as in straight distance, which is easy, but actual pathing distance with the terrain counted in. If you are close to another place in coordinates but it takes a huge detour to get there, that detour distance is pretty much the only thing that&#039;s relevant, right? I&#039;m thinking about this especially in terms of being afraid of other creatures, when fleeing it is very relevant information how close the threat actually is in terms of time to get to you, rather than mathematical shortest distance.<br><br>I think the triangulation technique could create pretty decent estimations for these non-direct distances. To get the exact distance you&#039;d need pathing, but this technique is probably at least 10 000 times quicker in most cases, and will hopefully produce acceptable results.<br><br>Ok, so take a look at this. Here&#039;s a dijkstra map for each exit, and I&#039;m trying to triangulate the distance between A and B. The data I have access to is the distance between those points and each exit.<br><br><img src="https://web.archive.org/web/20141229083422im_/http://imgwiz.com/images/2014/09/17/uxKC.png" alt="" border="0"><br><br>So what I&#039;d do here is basically imagine each map as a dimension. For the first dimension, then, A is at 25 and B is at 12. That makes our delta in that dimension 13.<br><br>ABS(25 - 12) = 13<br>ABS(18 - 60) = 42<br>ABS(40 - 6) = 34<br><br>(No I didn&#039;t count tiles, the numbers are just invented)<br><br>These distances in &quot;triangulation space&quot; can tell us some stuff. If we only have one dimension, we can&#039;t know very much, because there are many tiles on the map that are exactly 12 tiles away from a specific exit, and they are not necessarily close to <i>each other</i>. E.g 12 tiles to the left of the exit and 12 tiles to the right of the exit. If we have more dimensions to play with though, I think the triangulation would quickly become more reliable. At three dijkstra maps my estimation is that it would be extremely uncommon for two tiles to have the same combination of distances to all exits, making the coordinates in &quot;triangulation space&quot; pretty reliable in their relationships to other coordinates. Correct me if I&#039;m wrong here!<br><br>The system could potentially give a &quot;false close&quot;, but never a &quot;false far&quot;. An example of a &quot;false close&quot; would be if you have a room with an obstacle in the middle and an exit at the north and the south of the obstacle. A point to the west of the obstacle could have the same distance to both exits as a point to the east of the obstacle, making them appear identical or close in &quot;triangulation space&quot;. An asymmetric placement of the exits, or a third exit, would help with that though. <br><br>A &quot;false far&quot; can never happen, because if the points are separated in <i>any </i>of the &quot;triangulation space&quot; dimensions, they are <i>at least</i> as separated in actual travel tiles as well. Look at A and B in the third picture above - the absolutely closest they could be while having the distances 40 and 6 would be if B was 6 tiles up on the same path as A, and then they&#039;d still be 34 tiles separated.<br><br>Another way to say this is that if the deltas in all &quot;triangulation dimensions&quot; is 0, A and B might or might not be on the same tile, but if <i>any </i>dimension has a delta larger than zero, A and B are sure to not be on the same tile.<br><br>The fact that the system might give a &quot;false close&quot; but never a &quot;false far&quot; probably means that of the three deltas calculated in the example above, you should pick the biggest one, and conclude that the actual distance can be no larger than that. <br><br>I think this makes it fitting for fleeing behavior. These distances could be used to evaluate how nervous a creature should be about another creature, and whether it&#039;s time to calm down and stop the fleeing behavior. &quot;False close&quot; isn&#039;t too bad in this scenario, because better safe than sorry, right? <br><br>Also it will be cool to check out how this can be used in swarming behaviors. Maybe you could even create some strange kind of dynamic path finding using it, if you move towards whichever neighboring tile is the closest to your goal in triangulation space rather than in actual space. <br><br>Oh, when I read through my post before hitting the button I had a small epiphany! One way to further eliminate &quot;false close&quot; could be to add the mathematical straight distance between A and B and treat it exactly like one of the triangulation dimensions! It has the exact same properties - ie that A and B can&#039;t be <i>closer </i>than that, so it would work really well as a last reality check, eliminating for example the &quot;obstacle in the middle and symmetrical exits on each side&quot; problem. Shortcuts messes this up a little bit as they make it possible for tiles to be &quot;closer than they actually are&quot;, so maybe it shouldn&#039;t be relied upon too much. But shortcut travel still takes some time, so it could be counted in to some degree...